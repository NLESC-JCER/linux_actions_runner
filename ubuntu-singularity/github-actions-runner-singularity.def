Bootstrap: library
From: ubuntu:19.10
Stage: build

# %setup
#     touch /file1
#     touch ${SINGULARITY_ROOTFS}/file2

%files
    ./entrypoint.sh /
    # /entrypoint.sh /

%environment
    # export LC_ALL=C
    # export DEBIAN_FRONTEND=noninteractive
    # export RUNNER_VERSION=2.267.1
    # echo 'export RUNNER_VERSION=2.267.1' >>$SINGULARITY_ENVIRONMENT
    export AGENT_TOOLSDIRECTORY=/opt/hostedtoolcache
    export platform_version=18.04

%post
    export RUNNER_VERSION=2.267.1
    # main script
    chmod +x /entrypoint.sh

    apt-get install -y --no-install-recommends software-properties-common
    add-apt-repository universe
    add-apt-repository multiverse
    apt-get update -y
    apt-get install -y --no-install-recommends \
    ca-certificates \
    curl \
    jq \
    libcurl4-openssl-dev


    echo ${RUNNER_VERSION}
    mkdir /opt/actions-runner && cd /opt/actions-runner
    curl -L "https://github.com/actions/runner/releases/download/v${RUNNER_VERSION}/actions-runner-linux-x64-${RUNNER_VERSION}.tar.gz" > actions_runner.tar.gz && \
    tar -zxf actions_runner.tar.gz && \
    rm -f actions_runner.tar.gz && \
    ./bin/installdependencies.sh
    # chmod -R 755 /opt/actions-runner

    NOW=`date`
    echo "export NOW=\"${NOW}\"" >> $SINGULARITY_ENVIRONMENT
    echo "export AGENT_TOOLSDIRECTORY=/opt/hostedtoolcache" >> $SINGULARITY_ENVIRONMENT


%runscript
    echo "Container was created $NOW"
    echo "Arguments received: $*"
    exec /bin/bash /entrypoint.sh "$@"

# %startscript
#     nc -lp $LISTEN_PORT

# %test
#     grep -q NAME=\"Ubuntu\" /etc/os-release
#     if [ $? -eq 0 ]; then
#         echo "Container base is Ubuntu as expected."
#     else
#         echo "Container base is not Ubuntu."
#     fi

# %labels
#     Author d@sylabs.io
#     Version v0.0.1

# %help
#     This is a demo container used to illustrate a def file that uses all
#     supported sections.
